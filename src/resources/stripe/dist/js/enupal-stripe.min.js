!function(e){var n={};function t(a){if(n[a])return n[a].exports;var i=n[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(a,i,function(n){return e[n]}.bind(null,i));return a},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="/",t(t.s=0)}([function(e,n,t){e.exports=t(1)},function(e,n){var t={};!function(e){"use strict";t={paymentFormsList:{},finalData:{},zeroDecimals:{},init:function(){this.paymentFormsList=e(".enupal-stripe-form"),this.zeroDecimals=["MGA","BIF","CLP","PYG","DJF","RWF","GNF","UGX","JPY","VND","VUV","XAF","KMF","KRW","XOF","XPF"],this.paymentFormsList.each((function(){var n=e(this);t.initializeForm(n)}))},initializeForm:function(n){if(void 0===e(n).find('[name="enupalStripe[stripeData]"]').val())return!1;var a=e.parseJSON(e(n).find('[name="enupalStripe[stripeData]"]').val());a.lineItems=n.find('[name="enupalStripe[enupalLineItems]"]').val(),a.removeDefaultItem=n.find('[name="enupalStripe[enupalRemoveDefaultItem]"]').val(),navigator.userAgent.indexOf("Firefox")<0&&(e(n).find('[name="enupalStripe[stripeData]"]').val(""),n.find('[name="enupalStripe[enupalLineItems]"]').val(""),n.find('[name="enupalStripe[enupalRemoveDefaultItem]"]').val("")),this.finalData.finalAmount=a.stripe.amount;var i=null,o=this,r="stripe-payments-submit-button-"+a.paymentFormId;if(!a.useSca){i=StripeCheckout.configure({key:a.pbk,token:function(e,i){n.find('[name="enupalStripe[token]"]').val(e.id),n.find('[name="enupalStripe[email]"]').val(e.email),t.addValuesToForm(n,i,a),o.showProcessingText(n,a),n.unbind("submit",[n,a]),n.submit()},opened:function(){},closed:function(){}})}if(a.coupon.enabled){var s=e("#check-coupon-button-"+a.paymentFormId);this.updateTotalAmoutLabel(n,a);var u=n.find("#remove-coupon-"+a.paymentFormId);this.updatesTotalLabelOnChoosesPlan(n,a),u.click((function(e){e.preventDefault(),o.handleRemoveCoupon(n,a,o)})),s.click((function(e){e.preventDefault(),o.handleCouponValidation(n,a,o)}))}n.find("#"+r).on("click",(function(e){var o=n[0];o.checkValidity()?(e.preventDefault(),t.submitPayment(n,a,i)):o.reportValidity&&o.reportValidity()}))},showProcessingText:function(e,n){e.find("#stripe-payments-submit-button-"+n.paymentFormId).prop("disabled",!0),e.find("#stripe-payments-submit-button-"+n.paymentFormId).find("span").length?e.find("#stripe-payments-submit-button-"+n.paymentFormId).find("span").text(n.paymentButtonProcessingText):e.find("#stripe-payments-submit-button-"+n.paymentFormId).text(n.paymentButtonProcessingText)},updateTotalAmoutLabel:function(e,n){var t=e.find("#total-amount-value-"+n.paymentFormId),a=this.getFinalAmount(e,n);t&&t.text(a)},updatesTotalLabelOnChoosesPlan:function(n,t){var a=this;if(0!==t.subscriptionType)if("radio"==t.subscriptionStyle){var i=n.find('input[name="enupalStripe[enupalMultiPlan]"]');e(i).change((function(){e(this).is(":checked")&&a.handleRemoveCoupon(n,t,a)}))}else{var o=n.find('[name="enupalStripe[enupalMultiPlan]"]');e(o).on("change",(function(){a.handleRemoveCoupon(n,t,a)}))}},handleRemoveCoupon:function(e,n,t){var a=e.find("#coupon-message-"+n.paymentFormId),i=e.find("#remove-coupon-"+n.paymentFormId),o=e.find("#couponCode-"+n.paymentFormId);o&&o.val(""),a&&a.text(""),i.addClass("enupal--hidden"),e.find('[name="enupalCouponCode"]').val(""),t.updateTotalAmoutLabel(e,n)},handleCouponValidation:function(n,t,a){var i=n.find("#check-coupon-button-"+t.paymentFormId),o=n.find("#coupon-message-"+t.paymentFormId),r=n.find("#remove-coupon-"+t.paymentFormId),s=n.find("#total-amount-value-"+t.paymentFormId),u=n.find("#couponCode-"+t.paymentFormId),l=u.val(),p=t.stripe;u.val("");var d=this.convertToCents(a.getFinalAmount(n,t),p.currency);i.prop("disabled",!0);var c={action:"enupal-stripe/coupons/validate",amount:d,couponCode:l,isRecurring:this.getIsRecurring(n,t),currency:p.currency,successMessage:t.coupon.successMessage};e.ajax({type:"POST",url:"enupal/validate-coupon",data:c,dataType:"json",success:function(e){!0===e.success?(o.removeClass("coupon-error"),o.text(e.successMessage),r.removeClass("enupal--hidden"),s&&s.text(e.finalAmount),n.find('[name="enupalCouponCode"]').val(e.coupon.id)):(o.addClass("coupon-error"),r.addClass("enupal--hidden"),o.text(t.coupon.errorMessage)),i.prop("disabled",!1)}.bind(this),error:function(e,n,t){i.prop("disabled",!1),console.error(e,n,t.toString())}.bind(this)})},getIsRecurring:function(e,n){var t=!1;return 1==n.amountType&&(t=e.find('[name="enupalStripe[recurringToggle]"]').is(":checked")),n.enableSubscriptions&&(t=!0),t},addValuesToForm:function(e,n,t){if(t.stripe.shippingAddress){var a="shipping",i="address";this.setAddressToHiddenValues(a,i,n,e)}if(t.stripe.billingAddress){a="billing",i="billingAddress";this.setAddressToHiddenValues(a,i,n,e)}},setAddressToHiddenValues:function(e,n,t,a){t[e+"_name"]&&a.find('[name="enupalStripe['+n+'][name]"]').val(t[e+"_name"]),t[e+"_address_country"]&&a.find('[name="enupalStripe['+n+'][country]"]').val(t[e+"_address_country_code"]),t[e+"_address_zip"]&&a.find('[name="enupalStripe['+n+'][zip]"]').val(t[e+"_address_zip"]),t[e+"_address_state"]&&a.find('[name="enupalStripe['+n+'][state]"]').val(t[e+"_address_state"]),t[e+"_address_line1"]&&a.find('[name="enupalStripe['+n+'][line1]"]').val(t[e+"_address_line1"]),t[e+"_address_city"]&&a.find('[name="enupalStripe['+n+'][city]"]').val(t[e+"_address_city"])},redirectToCheckoutSession:function(n,t){this.showProcessingText(n,t);var a=n.serializeArray();a.push({name:"enupalStripe[enupalLineItems]",value:t.lineItems}),a.push({name:"enupalStripe[enupalRemoveDefaultItem]",value:t.removeDefaultItem}),a.push({name:"action",value:"enupal-stripe/checkout/create-session"}),a.push({name:"enupalStripeData",value:JSON.stringify(t)}),e.ajax({type:"POST",url:"enupal/stripe/create-checkout-session",data:a,dataType:"json",success:function(e){!0===e.success?Stripe(t.pbk).redirectToCheckout({sessionId:e.sessionId}):console.log("Something went wrong, please contact the admin")}.bind(this),error:function(e,n,t){console.error(e,n,t.toString())}.bind(this)})},submitPayment:function(n,t,a){var i=e.extend(!0,{},t),o=this,r=i.stripe;if(r.amount=this.convertToCents(this.getFinalAmount(n,i),r.currency),n.find('[name="enupalStripe[amount]"]').val(r.amount),n.find('[name="enupalStripe[testMode]"]').val(i.testMode),t.coupon.enabled){var s=n.find('[name="enupalCouponCode"]').val(),u=this.getIsRecurring(n,t);if(s){var l={action:"enupal-stripe/coupons/validate",amount:r.amount,couponCode:s,isRecurring:u,currency:r.currency,successMessage:t.coupon.successMessage};e.ajax({type:"POST",url:"enupal/validate-coupon",data:l,dataType:"json",success:function(e){!0===e.success&&(r.amount=e.finalAmountInCents),t.useSca?o.redirectToCheckoutSession(n,i):a.open(r)}.bind(this),error:function(e,n,t){console.error(e,n,t.toString())}.bind(this)})}else t.useSca?this.redirectToCheckoutSession(n,i):a.open(r)}else t.useSca?this.redirectToCheckoutSession(n,i):a.open(r)},getFinalAmount:function(n,t){var a=t.stripe.amount,i=0,o=!1;if(t.enableSubscriptions)if(0==t.subscriptionType){if(t.singleSetupFee>0&&(i=t.singleSetupFee),t.enableCustomPlanAmount)"undefined"!==(s=n.find('[name="enupalStripe[customPlanAmount]"]').val())&&s>0&&(a=s)}else{var r=null,s=null;if((r="radio"==t.subscriptionStyle?e('input[name="enupalStripe[enupalMultiPlan]"]:checked').val():n.find('[name="enupalStripe[enupalMultiPlan]"]').val())in t.multiplePlansAmounts&&(s=t.multiplePlansAmounts[r].amount,t.stripe.currency=t.multiplePlansAmounts[r].currency),r in t.setupFees){var u=t.setupFees[r];u>0&&(i=u)}"undefined"!==s&&s>0&&(a=s)}else if(1==t.amountType){var l=n.find('[name="enupalStripe[customAmount]"]').val();o=n.find('[name="enupalStripe[recurringToggle]"]').is(":checked"),"undefined"!==l&&l>0&&(a=l)}if((t.applyTax||o)&&t.enableTaxes){var p=parseFloat(t.tax/100*(parseFloat(a)+parseFloat(i))).toFixed(2);a=parseFloat(a)+parseFloat(p);var d=t.taxLabel+": "+t.currencySymbol+p;n.find('[name="enupalStripe[taxAmount]"]').val(p),n.find('[name="tax-amount-label"]').empty().append(d)}return parseFloat(a)+parseFloat(i)},convertToCents:function(e,n){return this.hasZeroDecimals(n)?e:(100*e).toFixed(0)},convertFromCents:function(e,n){return this.hasZeroDecimals(n)?e:e/100},hasZeroDecimals:function(e){for(var n=0;n<this.zeroDecimals.length;n++)if(this.zeroDecimals[n]===e.toUpperCase())return!0;return!1}},e(document).ready((function(e){t.init()}))}(jQuery)}]);